<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhysiSim Suite - UTP</title>
    <!-- Usaremos Tailwind CSS para un diseño rápido y moderno -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js para las gráficas en tiempo real -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* Estilos personalizados para el Canvas */
        canvas {
            image-rendering: pixelated; /* Para que se vea nítido */
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        /* Ocultar scrollbar pero permitir scroll */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-gray-100 text-slate-800 font-sans h-screen overflow-hidden selection:bg-blue-200 relative">

    <!-- ========================================== -->
    <!-- PANTALLA 1: MENÚ PRINCIPAL (HUB)           -->
    <!-- ========================================== -->
    <div id="screen-menu" class="h-full w-full flex flex-col items-center justify-center bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white relative overflow-hidden overflow-y-auto">
        
        <!-- Elementos decorativos de fondo -->
        <div class="absolute top-0 left-0 w-full h-full overflow-hidden opacity-10 pointer-events-none">
            <div class="absolute top-10 left-10 w-64 h-64 bg-blue-500 rounded-full mix-blend-multiply filter blur-3xl animate-blob"></div>
            <div class="absolute top-10 right-10 w-64 h-64 bg-purple-500 rounded-full mix-blend-multiply filter blur-3xl animate-blob animation-delay-2000"></div>
            <div class="absolute -bottom-32 left-20 w-64 h-64 bg-pink-500 rounded-full mix-blend-multiply filter blur-3xl animate-blob animation-delay-4000"></div>
        </div>

        <div class="z-10 w-full max-w-6xl px-6 py-12 flex flex-col items-center gap-10">
            
            <!-- Encabezado Principal -->
            <div class="text-center">
                <h1 class="text-5xl md:text-6xl font-extrabold tracking-tight mb-2 text-transparent bg-clip-text bg-gradient-to-r from-blue-200 to-cyan-400 uppercase">
                    SIMULADOR INTERACTIVO UTP
                </h1>
                <p class="text-lg md:text-xl text-blue-100 font-light tracking-wide uppercase pt-2">
                    SIMULADOR EN 3 DIMENSIONES CON CÁLCULOS FÍSICOS
                </p>
            </div>

            <!-- TARJETA DE PERFIL Y DESCRIPCIÓN DEL PROGRAMA -->
            <div class="w-full max-w-5xl glass-panel rounded-2xl p-8 flex flex-col md:flex-row gap-8 text-left">
                
                <!-- Columna Izquierda: Perfil del Desarrollador (SIN FOTO) -->
                <div class="flex-shrink-0 flex flex-col items-center md:items-start w-full md:w-1/3 border-b md:border-b-0 md:border-r border-gray-600/30 pb-6 md:pb-0 md:pr-6">
                    
                    <h2 class="text-2xl font-bold text-white text-center md:text-left mb-1">Juan José Ocampo Arias</h2>
                    <p class="text-cyan-300 font-medium text-xs uppercase tracking-wider mb-4 text-center md:text-left">Ing. Sistemas • Programador Junior</p>
                    
                    <p class="text-gray-400 text-sm italic text-center md:text-left leading-relaxed">
                        "Joven de 16 años de Pereira, apasionado por crear tecnología que facilite el aprendizaje."
                    </p>
                </div>
                
                <!-- Columna Derecha: Descripción del Programa -->
                <div class="flex-1 flex flex-col justify-center">
                    <h3 class="text-2xl font-bold text-blue-200 mb-3 flex items-center gap-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Sobre el Simulador
                    </h3>
                    
                    <p class="text-gray-300 text-sm leading-relaxed mb-4">
                        Este software es una <strong>suite de simulación física en tiempo real</strong> diseñada para visualizar conceptos abstractos de mecánica clásica. A través de un motor de física personalizado escrito en JavaScript, el programa calcula y renderiza el comportamiento de objetos en escenarios de:
                    </p>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <div class="bg-white/5 rounded p-2 text-xs text-gray-300 border border-white/10">
                            <strong class="text-blue-300 block mb-1">Cinemática 1D:</strong>
                            Movimiento rectilíneo, colisiones y energía cinética.
                        </div>
                        <div class="bg-white/5 rounded p-2 text-xs text-gray-300 border border-white/10">
                            <strong class="text-purple-300 block mb-1">Proyectiles 2D:</strong>
                            Trayectorias parabólicas y descomposición vectorial.
                        </div>
                        <div class="bg-white/5 rounded p-2 text-xs text-gray-300 border border-white/10">
                            <strong class="text-pink-300 block mb-1">Dinámica Rotacional:</strong>
                            Torques, inercia y conservación del momentum angular.
                        </div>
                        <div class="bg-white/5 rounded p-2 text-xs text-gray-300 border border-white/10">
                            <strong class="text-green-300 block mb-1">Interactividad:</strong>
                            Control total de variables y gráficas en vivo.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tarjetas de Módulos -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full">
                
                <!-- Tarjeta Módulo 1 -->
                <div onclick="navigateTo('screen-linear')" class="group relative bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl p-6 cursor-pointer transition-all duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-blue-500/20 backdrop-blur-sm">
                    <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 bg-blue-600 rounded-full p-3 shadow-lg group-hover:bg-blue-500 transition-colors">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    </div>
                    <h3 class="mt-6 text-xl font-bold text-center mb-2">Lineal (1D)</h3>
                    <p class="text-gray-400 text-center text-xs">Cinemática MRU/MRUA, Fuerzas y Colisiones.</p>
                </div>

                <!-- Tarjeta Módulo 2 -->
                <div onclick="navigateTo('screen-projectile')" class="group relative bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl p-6 cursor-pointer transition-all duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-purple-500/20 backdrop-blur-sm">
                    <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 bg-purple-600 rounded-full p-3 shadow-lg group-hover:bg-purple-500 transition-colors">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
                    </div>
                    <h3 class="mt-6 text-xl font-bold text-center mb-2">Proyectiles (2D)</h3>
                    <p class="text-gray-400 text-center text-xs">Movimiento Parabólico y vectores.</p>
                </div>

                <!-- Tarjeta Módulo 3 -->
                <div onclick="navigateTo('screen-rotational')" class="group relative bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl p-6 cursor-pointer transition-all duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-pink-500/20 backdrop-blur-sm">
                    <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 bg-pink-600 rounded-full p-3 shadow-lg group-hover:bg-pink-500 transition-colors">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                    </div>
                    <h3 class="mt-6 text-xl font-bold text-center mb-2">Rotacional</h3>
                    <p class="text-gray-400 text-center text-xs">Torques, Inercia y Momentum Angular.</p>
                </div>
            </div>

            <footer class="text-gray-500 text-xs font-medium tracking-wider uppercase mt-8">
                DESARROLLADO POR JUAN JOSE OCAMPO - UTP © 2025
            </footer>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- PANTALLA 2: SIMULADOR LINEAL (1D)          -->
    <!-- ========================================== -->
    <div id="screen-linear" class="hidden h-full w-full flex flex-col bg-slate-50 relative">
        <!-- Barra superior -->
        <div class="bg-white border-b border-gray-200 px-6 py-3 flex justify-between items-center shadow-sm z-10">
            <div class="flex items-center gap-3">
                <button onclick="navigateTo('screen-menu')" class="p-2 hover:bg-gray-100 rounded-full text-gray-600 transition-colors" title="Volver al Menú">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                </button>
                <div>
                    <h2 class="font-bold text-lg text-slate-800">Simulación Lineal (1D)</h2>
                    <p class="text-xs text-slate-500">MRU / MRUA / Colisiones / Energía</p>
                </div>
            </div>
            
            <div class="flex gap-2">
                <button onclick="linearSim.reset()" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium text-sm transition-colors">Reiniciar</button>
                <button id="btn-play-pause-linear" onclick="linearSim.togglePlay()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-sm transition-colors flex items-center gap-2">
                    <span id="icon-play-linear">▶</span> <span id="text-play-linear">Simular</span>
                </button>
            </div>
        </div>

        <!-- Área de contenido -->
        <div class="flex-1 flex overflow-hidden">
            
            <!-- Panel Izquierdo: Controles -->
            <div class="w-80 bg-white border-r border-gray-200 p-6 flex flex-col gap-6 overflow-y-auto z-10 shadow-[4px_0_24px_rgba(0,0,0,0.02)]">
                
                <!-- Sección de Configuración -->
                <div>
                    <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4">Parámetros</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Posición Inicial</label>
                            <div class="flex items-center gap-2">
                                <input type="number" id="input-x0" value="0" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-sm">
                                <span class="text-gray-500 text-sm">m</span>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Velocidad Inicial</label>
                            <div class="flex items-center gap-2">
                                <input type="number" id="input-v0" value="0" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-sm">
                                <span class="text-gray-500 text-sm">m/s</span>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Aceleración</label>
                            <div class="flex items-center gap-2">
                                <input type="number" id="input-a" value="2" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-sm">
                                <span class="text-gray-500 text-sm">m/s²</span>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Masa del Objeto</label>
                            <div class="flex items-center gap-2">
                                <input type="number" id="input-m" value="10" min="1" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-sm">
                                <span class="text-gray-500 text-sm">kg</span>
                            </div>
                        </div>

                         <!-- Selector de objeto -->
                         <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Objeto</label>
                            <select id="select-obj" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                                <option value="car">Automóvil Deportivo</option>
                                <option value="box">Caja Genérica</option>
                                <option value="ball">Esfera</option>
                            </select>
                        </div>

                        <!-- Checkbox Muro -->
                        <div class="flex items-center mt-2">
                            <input type="checkbox" id="check-wall" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                            <label for="check-wall" class="ml-2 text-sm font-medium text-gray-900">Activar Muro (Colisión)</label>
                        </div>
                    </div>
                </div>

                <!-- Sección de Datos en Tiempo Real -->
                <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Dinámica y Energía</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-500">Tiempo:</span>
                            <span class="font-mono font-bold" id="disp-t">0.00 s</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500">Posición:</span>
                            <span class="font-mono font-bold text-blue-600" id="disp-x">0.00 m</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500">Velocidad:</span>
                            <span class="font-mono font-bold text-green-600" id="disp-v">0.00 m/s</span>
                        </div>
                        <div class="border-t border-gray-200 my-2"></div>
                        <div class="flex justify-between">
                            <span class="text-gray-500">Fuerza Neta:</span>
                            <span class="font-mono font-bold text-purple-600" id="disp-f">0.00 N</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500">Momentum:</span>
                            <span class="font-mono font-bold text-orange-600" id="disp-p">0.00 kg·m/s</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500">Energía Cinética:</span>
                            <span class="font-mono font-bold text-red-600" id="disp-k">0.00 J</span>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Panel Central: Visualización y Gráficas -->
            <div class="flex-1 flex flex-col bg-slate-100 relative">
                
                <!-- Lienzo de Simulación (El mundo) -->
                <div class="h-1/2 relative bg-sky-200 border-b border-gray-300 overflow-hidden" id="canvas-container">
                    <!-- Fondo (Cielo y suelo) -->
                    <div class="absolute bottom-0 w-full h-1/3 bg-emerald-600 border-t-4 border-emerald-700"></div>
                    <!-- Carretera -->
                    <div class="absolute bottom-8 w-full h-24 bg-gray-700 border-y-4 border-gray-800 flex items-center overflow-hidden">
                        <!-- Líneas de la carretera -->
                        <div class="w-full h-0 border-t-2 border-dashed border-white opacity-50"></div>
                    </div>
                    
                    <!-- Elementos de medida (Regla) -->
                    <div class="absolute bottom-0 w-full h-8 bg-white/80 flex items-end text-[10px] text-gray-600 font-mono overflow-hidden" id="ruler">
                        <!-- Se llena con JS -->
                    </div>

                    <!-- Muro (Oculto por defecto) -->
                    <div id="wall-obj" class="hidden absolute bottom-16 w-4 h-32 bg-stone-700 border-2 border-stone-500 shadow-xl" style="left: 600px;"></div>

                    <!-- El Objeto (Se mueve con JS) -->
                    <div id="simulation-object" class="absolute bottom-16 left-0 w-16 h-8 transition-transform will-change-transform" style="transform: translateX(0px);">
                        <!-- SVG del Carro -->
                        <svg class="w-full h-full drop-shadow-lg" viewBox="0 0 100 50" id="svg-car">
                            <path fill="#ef4444" d="M10,35 L90,35 L90,20 L70,10 L30,10 L10,20 Z" /> <!-- Chasis -->
                            <circle cx="25" cy="35" r="10" fill="#333" /> <!-- Rueda 1 -->
                            <circle cx="75" cy="35" r="10" fill="#333" /> <!-- Rueda 2 -->
                            <circle cx="25" cy="35" r="4" fill="#ddd" /> <!-- Rin 1 -->
                            <circle cx="75" cy="35" r="4" fill="#ddd" /> <!-- Rin 2 -->
                            <path fill="#bae6fd" d="M35,12 L65,12 L80,20 L20,20 Z" /> <!-- Ventana -->
                        </svg>
                        <!-- SVG Caja (Oculto por defecto) -->
                         <div id="svg-box" class="w-12 h-12 bg-amber-700 border-2 border-amber-900 flex items-center justify-center text-white text-xs font-bold hidden shadow-lg">
                            Masa
                        </div>
                         <!-- SVG Bola (Oculto por defecto) -->
                         <div id="svg-ball" class="w-10 h-10 bg-indigo-600 rounded-full border-2 border-indigo-800 hidden shadow-lg"></div>
                    </div>

                    <!-- Marcador de Posición -->
                    <div class="absolute top-4 right-4 bg-white/90 px-3 py-1 rounded shadow text-sm font-mono" id="world-pos-indicator">
                        x: 0m
                    </div>
                </div>

                <!-- Panel de Gráficas (Cuadrícula 2x2) -->
                <div class="h-1/2 bg-white p-4 grid grid-cols-2 grid-rows-2 gap-4">
                    <div class="border border-gray-100 rounded-lg p-2 shadow-sm relative">
                        <h4 class="text-[10px] font-bold text-gray-500 absolute top-1 left-2">Posición vs Tiempo</h4>
                        <div class="h-full w-full pt-4">
                            <canvas id="chart-lin-pos"></canvas>
                        </div>
                    </div>
                    <div class="border border-gray-100 rounded-lg p-2 shadow-sm relative">
                        <h4 class="text-[10px] font-bold text-gray-500 absolute top-1 left-2">Velocidad vs Tiempo</h4>
                        <div class="h-full w-full pt-4">
                            <canvas id="chart-lin-vel"></canvas>
                        </div>
                    </div>
                    <div class="border border-gray-100 rounded-lg p-2 shadow-sm relative">
                        <h4 class="text-[10px] font-bold text-gray-500 absolute top-1 left-2">Aceleración vs Tiempo</h4>
                        <div class="h-full w-full pt-4">
                            <canvas id="chart-lin-acc"></canvas>
                        </div>
                    </div>
                    <div class="border border-gray-100 rounded-lg p-2 shadow-sm relative">
                        <h4 class="text-[10px] font-bold text-gray-500 absolute top-1 left-2">Energía Cinética vs Tiempo</h4>
                        <div class="h-full w-full pt-4">
                            <canvas id="chart-lin-ken"></canvas>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- PANTALLA 3: SIMULADOR DE PROYECTILES (2D)  -->
    <!-- ========================================== -->
    <div id="screen-projectile" class="hidden h-full w-full flex flex-col bg-purple-50 relative">
        <!-- Barra superior -->
        <div class="bg-white border-b border-gray-200 px-6 py-3 flex justify-between items-center shadow-sm z-10">
            <div class="flex items-center gap-3">
                <button onclick="navigateTo('screen-menu')" class="p-2 hover:bg-gray-100 rounded-full text-gray-600 transition-colors" title="Volver al Menú">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                </button>
                <div>
                    <h2 class="font-bold text-lg text-slate-800">Simulación de Proyectiles (2D)</h2>
                    <p class="text-xs text-purple-600">Movimiento Parabólico</p>
                </div>
            </div>
            
            <div class="flex gap-2">
                <button onclick="projectileSim.reset()" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium text-sm transition-colors">Reiniciar</button>
                <button id="btn-play-pause-projectile" onclick="projectileSim.togglePlay()" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium text-sm transition-colors flex items-center gap-2">
                    <span id="icon-play-projectile">▶</span> <span id="text-play-projectile">Lanzar</span>
                </button>
            </div>
        </div>

        <div class="flex-1 flex overflow-hidden">
            <!-- Controles 2D -->
            <div class="w-72 bg-white border-r border-gray-200 p-6 flex flex-col gap-6 overflow-y-auto z-10 shadow-[4px_0_24px_rgba(0,0,0,0.02)]">
                <div>
                    <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4">Condiciones de Lanzamiento</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Velocidad Inicial</label>
                            <div class="flex items-center gap-2">
                                <input type="number" id="input-proj-v0" value="25" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm text-purple-700 font-bold">
                                <span class="text-gray-500 text-sm">m/s</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Ángulo</label>
                            <div class="flex items-center gap-2">
                                <input type="range" id="input-proj-angle" min="0" max="90" value="45" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600">
                                <span id="disp-angle-val" class="text-sm font-mono w-12 text-right">45°</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Gravedad</label>
                            <div class="flex items-center gap-2">
                                <input type="number" id="input-proj-g" value="9.8" step="0.1" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                                <span class="text-gray-500 text-sm">m/s²</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Datos en Vivo 2D -->
                <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                    <h3 class="text-xs font-bold text-purple-400 uppercase tracking-wider mb-3">Datos de Vuelo</h3>
                    <div class="grid grid-cols-2 gap-y-2 gap-x-2 text-xs">
                        <div class="text-gray-500">Tiempo:</div>
                        <div class="font-mono font-bold text-right" id="disp-proj-t">0.00 s</div>
                        
                        <div class="text-gray-500">Posición X:</div>
                        <div class="font-mono font-bold text-right text-blue-600" id="disp-proj-x">0.00 m</div>
                        
                        <div class="text-gray-500">Posición Y:</div>
                        <div class="font-mono font-bold text-right text-red-600" id="disp-proj-y">0.00 m</div>

                        <div class="text-gray-500">Velocidad Y:</div>
                        <div class="font-mono font-bold text-right" id="disp-proj-vy">0.00 m/s</div>
                    </div>
                </div>
            </div>

            <!-- Visualización 2D -->
            <div class="flex-1 flex flex-col bg-slate-100 relative">
                <!-- Canvas para 2D -->
                <div class="h-2/3 relative bg-gradient-to-b from-sky-200 to-sky-100 border-b border-gray-300 overflow-hidden" id="proj-canvas-container">
                    <canvas id="canvas-projectile" class="absolute top-0 left-0 w-full h-full"></canvas>
                    
                    <!-- Indicadores flotantes -->
                    <div class="absolute bottom-4 left-4 bg-white/80 px-2 py-1 rounded text-xs text-gray-500">Escala: 10px = 1m</div>
                </div>

                <!-- Gráficas 2D (Split) -->
                <div class="h-1/3 bg-white p-4 flex gap-4">
                    <div class="flex-1 border border-gray-100 rounded-lg p-2 shadow-sm relative">
                        <h4 class="text-[10px] font-bold text-gray-500 absolute top-1 left-2">Trayectoria (Altura vs Distancia)</h4>
                        <div class="h-full w-full pt-4">
                            <canvas id="chart-proj-traj"></canvas>
                        </div>
                    </div>
                    <div class="flex-1 border border-gray-100 rounded-lg p-2 shadow-sm relative">
                        <h4 class="text-[10px] font-bold text-gray-500 absolute top-1 left-2">Energías vs Tiempo</h4>
                        <div class="h-full w-full pt-4">
                            <canvas id="chart-proj-energy"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- ========================================== -->
    <!-- PANTALLA 4: SIMULADOR ROTACIONAL           -->
    <!-- ========================================== -->
    <div id="screen-rotational" class="hidden h-full w-full flex flex-col bg-pink-50 relative">
        <!-- Barra superior -->
        <div class="bg-white border-b border-gray-200 px-6 py-3 flex justify-between items-center shadow-sm z-10">
            <div class="flex items-center gap-3">
                <button onclick="navigateTo('screen-menu')" class="p-2 hover:bg-gray-100 rounded-full text-gray-600 transition-colors" title="Volver al Menú">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                </button>
                <div>
                    <h2 class="font-bold text-lg text-slate-800">Dinámica Rotacional</h2>
                    <p class="text-xs text-pink-600">Torque, Inercia y Momentum Angular</p>
                </div>
            </div>
            
            <div class="flex gap-2">
                <button onclick="rotationalSim.reset()" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium text-sm transition-colors">Reiniciar</button>
                <button id="btn-play-pause-rotational" onclick="rotationalSim.togglePlay()" class="px-4 py-2 bg-pink-600 hover:bg-pink-700 text-white rounded-lg font-medium text-sm transition-colors flex items-center gap-2">
                    <span id="icon-play-rotational">▶</span> <span id="text-play-rotational">Girar</span>
                </button>
            </div>
        </div>

        <div class="flex-1 flex overflow-hidden">
            <!-- Controles Rotacional -->
            <div class="w-72 bg-white border-r border-gray-200 p-6 flex flex-col gap-6 overflow-y-auto z-10 shadow-[4px_0_24px_rgba(0,0,0,0.02)]">
                <div>
                    <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4">Propiedades del Disco</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Fuerza Aplicada</label>
                            <div class="flex items-center gap-2">
                                <input type="number" id="input-rot-f" value="10" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm text-pink-700 font-bold">
                                <span class="text-gray-500 text-sm">N</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Masa del Disco</label>
                            <div class="flex items-center gap-2">
                                <input type="number" id="input-rot-m" value="5" min="0.1" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                                <span class="text-gray-500 text-sm">kg</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Radio</label>
                            <div class="flex items-center gap-2">
                                <input type="number" id="input-rot-r" value="2" min="0.5" step="0.5" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                                <span class="text-gray-500 text-sm">m</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Datos Calculados -->
                <div class="bg-pink-50 p-4 rounded-lg border border-pink-200 space-y-3">
                    <h3 class="text-xs font-bold text-pink-400 uppercase tracking-wider">Variables Dinámicas</h3>
                    
                    <div>
                        <div class="flex justify-between text-xs text-gray-600 mb-1">
                            <span>Torque:</span>
                        </div>
                        <div class="font-mono font-bold text-right text-pink-700" id="disp-rot-torque">0.00 N·m</div>
                    </div>

                    <div>
                        <div class="flex justify-between text-xs text-gray-600 mb-1">
                            <span>Inercia:</span>
                        </div>
                        <div class="font-mono font-bold text-right text-purple-700" id="disp-rot-inertia">0.00 kg·m²</div>
                    </div>

                    <div>
                        <div class="flex justify-between text-xs text-gray-600 mb-1">
                            <span>Momentum Angular (L):</span>
                        </div>
                        <div class="font-mono font-bold text-right text-orange-600" id="disp-rot-momentum">0.00 kg·m²/s</div>
                    </div>

                    <div>
                        <div class="flex justify-between text-xs text-gray-600 mb-1">
                            <span>Trabajo Rotacional (W):</span>
                        </div>
                        <div class="font-mono font-bold text-right text-green-600" id="disp-rot-work">0.00 J</div>
                    </div>

                    <div>
                        <div class="flex justify-between text-xs text-gray-600 mb-1">
                            <span>Aceleración Angular:</span>
                        </div>
                        <div class="font-mono font-bold text-right text-blue-700" id="disp-rot-alpha">0.00 rad/s²</div>
                    </div>
                </div>
                
                 <!-- Dato en Vivo -->
                 <div class="bg-slate-100 p-4 rounded-lg border border-gray-200">
                    <div class="text-gray-500 text-xs mb-1">Velocidad Angular:</div>
                    <div class="font-mono font-bold text-right text-xl" id="disp-rot-omega">0.00 rad/s</div>
                </div>

            </div>

            <!-- Visualización Rotacional -->
            <div class="flex-1 flex flex-col bg-slate-50 relative">
                <!-- Canvas -->
                <div class="h-2/3 relative flex items-center justify-center overflow-hidden border-b border-gray-300" id="rot-canvas-container">
                    <!-- Patrón de fondo -->
                    <div class="absolute inset-0 opacity-10" style="background-image: radial-gradient(#9ca3af 1px, transparent 1px); background-size: 20px 20px;"></div>
                    
                    <canvas id="canvas-rotational"></canvas>
                </div>

                <!-- Gráficas (Split) -->
                <div class="h-1/3 bg-white p-4 flex gap-4">
                    <div class="flex-1 border border-gray-100 rounded-lg p-2 shadow-sm relative">
                        <h4 class="text-[10px] font-bold text-gray-500 absolute top-1 left-2">Velocidad Angular vs Tiempo</h4>
                        <div class="h-full w-full pt-4">
                            <canvas id="chart-rot-omega"></canvas>
                        </div>
                    </div>
                    <div class="flex-1 border border-gray-100 rounded-lg p-2 shadow-sm relative">
                        <h4 class="text-[10px] font-bold text-gray-500 absolute top-1 left-2">Energía Cinética Rotacional vs Tiempo</h4>
                        <div class="h-full w-full pt-4">
                            <canvas id="chart-rot-energy"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- ========================================== -->
    <!-- LÓGICA JAVASCRIPT                          -->
    <!-- ========================================== -->
    <script>
        // --- SISTEMA DE NAVEGACIÓN ---
        function navigateTo(screenId) {
            document.querySelectorAll('[id^="screen-"]').forEach(el => el.classList.add('hidden'));
            document.getElementById(screenId).classList.remove('hidden');
            
            if(screenId === 'screen-linear') linearSim.resize();
            if(screenId === 'screen-projectile') projectileSim.initCanvas();
            if(screenId === 'screen-rotational') rotationalSim.initCanvas();
        }

        // --- UTILIDAD PARA DOM SEGURO ---
        function getEl(id) {
            return document.getElementById(id);
        }
        function setText(el, text) {
            if(el) el.innerText = text;
        }

        // --- MÓDULO 1: SIMULADOR LINEAL ---
        const linearSim = {
            isRunning: false, time: 0, dt: 0.02, scale: 20, interval: null,
            state: { x0: 0, v0: 0, a: 2, m: 10, x: 0, v: 0, f: 0, p: 0, k: 0 },
            wallPos: 27.5,
            charts: { pos: null, vel: null, acc: null, ken: null },
            dataPoints: { labels: [], x: [], v: [], a: [], k: [] },
            dom: {}, 

            init: function() {
                this.dom = {
                    obj: getEl('simulation-object'),
                    dispT: getEl('disp-t'),
                    dispX: getEl('disp-x'),
                    dispV: getEl('disp-v'),
                    dispF: getEl('disp-f'),
                    dispP: getEl('disp-p'),
                    dispK: getEl('disp-k'),
                    wall: getEl('wall-obj'),
                    ruler: getEl('ruler'),
                    container: getEl('canvas-container'),
                    svgCar: getEl('svg-car'),
                    svgBox: getEl('svg-box'),
                    svgBall: getEl('svg-ball'),
                    selectObj: getEl('select-obj'),
                    inputs: { 
                        x0: getEl('input-x0'), 
                        v0: getEl('input-v0'), 
                        a: getEl('input-a'),
                        m: getEl('input-m'),
                        wall: getEl('check-wall')
                    }
                };

                this.initCharts();
                this.generateRuler();
                this.reset();

                if(this.dom.selectObj) {
                    this.dom.selectObj.addEventListener('change', (e) => {
                        this.dom.svgCar.style.display = 'none';
                        this.dom.svgBox.style.display = 'none';
                        this.dom.svgBall.style.display = 'none';
                        if(e.target.value === 'car') this.dom.svgCar.style.display = 'block';
                        if(e.target.value === 'box') { 
                            this.dom.svgBox.style.display = 'flex'; 
                            this.dom.obj.style.bottom = '32px'; 
                        } else {
                            this.dom.obj.style.bottom = '40px'; 
                        }
                        if(e.target.value === 'ball') this.dom.svgBall.style.display = 'block';
                    });
                }
                
                if(this.dom.inputs.wall) {
                    this.dom.inputs.wall.addEventListener('change', (e) => {
                        if(this.dom.wall) this.dom.wall.style.display = e.target.checked ? 'block' : 'none';
                    });
                }
            },

            togglePlay: function() { if(this.isRunning) { this.pause(); } else { this.play(); } },
            
            play: function() {
                if(this.time === 0) {
                    this.state.x0 = parseFloat(this.dom.inputs.x0.value) || 0;
                    this.state.v0 = parseFloat(this.dom.inputs.v0.value) || 0;
                    this.state.a = parseFloat(this.dom.inputs.a.value) || 0;
                    this.state.m = parseFloat(this.dom.inputs.m.value) || 10;
                    this.state.x = this.state.x0;
                    this.state.v = this.state.v0;
                }
                Object.values(this.dom.inputs).forEach(inp => { if(inp) inp.disabled = true; });
                this.isRunning = true;
                this.updatePlayButton(true);
                this.interval = setInterval(() => this.update(), this.dt * 1000);
            },

            pause: function() {
                this.isRunning = false; clearInterval(this.interval);
                this.updatePlayButton(false);
            },

            reset: function() {
                this.pause();
                this.time = 0;
                Object.values(this.dom.inputs).forEach(inp => { if(inp) inp.disabled = false; });
                
                this.state.x = this.dom.inputs.x0 ? (parseFloat(this.dom.inputs.x0.value) || 0) : 0;
                this.state.v = this.dom.inputs.v0 ? (parseFloat(this.dom.inputs.v0.value) || 0) : 0;
                this.state.a = this.dom.inputs.a ? (parseFloat(this.dom.inputs.a.value) || 0) : 0;
                this.state.m = this.dom.inputs.m ? (parseFloat(this.dom.inputs.m.value) || 10) : 10;
                
                this.dataPoints = { labels: [], x: [], v: [], a: [], k: [] };
                this.updateCharts();
                this.render();
            },

            update: function() {
                this.time += this.dt;
                this.state.v += this.state.a * this.dt;
                this.state.x += this.state.v * this.dt;

                if(this.dom.inputs.wall && this.dom.inputs.wall.checked && this.state.x >= this.wallPos) {
                    this.state.x = this.wallPos;
                    this.state.v = -this.state.v * 0.8;
                }

                this.state.f = this.state.m * this.state.a;
                this.state.p = this.state.m * this.state.v;
                this.state.k = 0.5 * this.state.m * this.state.v * this.state.v;

                if(Math.round(this.time * 100) % 10 === 0) {
                    this.dataPoints.labels.push(this.time.toFixed(1));
                    this.dataPoints.x.push(this.state.x);
                    this.dataPoints.v.push(this.state.v);
                    this.dataPoints.a.push(this.state.a);
                    this.dataPoints.k.push(this.state.k);
                    
                    if(this.dataPoints.labels.length > 50) { 
                        this.dataPoints.labels.shift(); 
                        this.dataPoints.x.shift(); 
                        this.dataPoints.v.shift(); 
                        this.dataPoints.a.shift();
                        this.dataPoints.k.shift();
                    }
                    this.updateCharts();
                }
                this.render();
            },

            render: function() {
                setText(this.dom.dispT, this.time.toFixed(2) + ' s');
                setText(this.dom.dispX, this.state.x.toFixed(2) + ' m');
                setText(this.dom.dispV, this.state.v.toFixed(2) + ' m/s');
                setText(this.dom.dispF, this.state.f.toFixed(2) + ' N');
                setText(this.dom.dispP, this.state.p.toFixed(2) + ' kg·m/s');
                setText(this.dom.dispK, this.state.k.toFixed(2) + ' J');

                if(this.dom.obj) {
                    const pixelPos = 50 + (this.state.x * this.scale);
                    this.dom.obj.style.transform = `translateX(${pixelPos}px)`;
                    
                    // Auto-scroll
                    const container = this.dom.container;
                    if(container) {
                        setText(getEl('world-pos-indicator'), `x: ${this.state.x.toFixed(1)}m`);
                        if(pixelPos > container.scrollLeft + container.clientWidth - 100) { 
                            container.scrollLeft = pixelPos - container.clientWidth + 200; 
                        } else if (pixelPos < container.scrollLeft) { 
                            container.scrollLeft = pixelPos - 50; 
                        }
                    }
                }
            },

            generateRuler: function() {
                if(!this.dom.ruler) return;
                let html = '';
                for(let i=0; i<1000; i+=1) {
                    const left = 50 + (i * this.scale);
                    const height = (i % 5 === 0) ? 'h-full' : 'h-1/2';
                    const label = (i % 5 === 0) ? `<span class="absolute -top-4 left-[-10px]">${i}m</span>` : '';
                    html += `<div class="absolute bottom-0 w-[1px] bg-gray-400 ${height}" style="left: ${left}px; height: 10px;">${label}</div>`;
                }
                this.dom.ruler.innerHTML = html;
            },

            resize: function() {
                Object.values(this.charts).forEach(c => { if(c) c.resize(); });
            },

            initCharts: function() {
                const ctxPos = document.getElementById('chart-lin-pos');
                const ctxVel = document.getElementById('chart-lin-vel');
                const ctxAcc = document.getElementById('chart-lin-acc');
                const ctxKen = document.getElementById('chart-lin-ken');
                
                if(!ctxPos || !ctxVel || !ctxAcc || !ctxKen) return;

                const commonOpts = { 
                    responsive: true, maintainAspectRatio: false, animation: false, 
                    scales: { x: { grid: { display: false } }, y: { border: { dash: [4, 4] } } }, 
                    plugins: { legend: { display: false } }, elements: { point: { radius: 0 } } 
                };
                
                this.charts.pos = new Chart(ctxPos.getContext('2d'), { type: 'line', data: { labels: [], datasets: [{ label: 'x(t)', data: [], borderColor: '#2563eb', borderWidth: 2 }] }, options: commonOpts });
                this.charts.vel = new Chart(ctxVel.getContext('2d'), { type: 'line', data: { labels: [], datasets: [{ label: 'v(t)', data: [], borderColor: '#16a34a', borderWidth: 2 }] }, options: commonOpts });
                this.charts.acc = new Chart(ctxAcc.getContext('2d'), { type: 'line', data: { labels: [], datasets: [{ label: 'a(t)', data: [], borderColor: '#9333ea', borderWidth: 2 }] }, options: commonOpts });
                this.charts.ken = new Chart(ctxKen.getContext('2d'), { type: 'line', data: { labels: [], datasets: [{ label: 'K(t)', data: [], borderColor: '#dc2626', borderWidth: 2, fill: true, backgroundColor: 'rgba(220, 38, 38, 0.1)' }] }, options: commonOpts });
            },

            updateCharts: function() {
                if(this.charts.pos) { this.charts.pos.data.labels = this.dataPoints.labels; this.charts.pos.data.datasets[0].data = this.dataPoints.x; this.charts.pos.update(); }
                if(this.charts.vel) { this.charts.vel.data.labels = this.dataPoints.labels; this.charts.vel.data.datasets[0].data = this.dataPoints.v; this.charts.vel.update(); }
                if(this.charts.acc) { this.charts.acc.data.labels = this.dataPoints.labels; this.charts.acc.data.datasets[0].data = this.dataPoints.a; this.charts.acc.update(); }
                if(this.charts.ken) { this.charts.ken.data.labels = this.dataPoints.labels; this.charts.ken.data.datasets[0].data = this.dataPoints.k; this.charts.ken.update(); }
            },

            updatePlayButton: function(playing) {
                const btn = document.getElementById('btn-play-pause-linear');
                const text = document.getElementById('text-play-linear');
                const icon = document.getElementById('icon-play-linear');
                if(!btn) return;

                if(playing) {
                    if(text) text.innerText = "Pausar"; 
                    if(icon) icon.innerText = "⏸";
                    btn.classList.replace('bg-blue-600', 'bg-yellow-500'); 
                    btn.classList.replace('hover:bg-blue-700', 'hover:bg-yellow-600');
                } else {
                    if(text) text.innerText = "Simular"; 
                    if(icon) icon.innerText = "▶";
                    btn.classList.replace('bg-yellow-500', 'bg-blue-600'); 
                    btn.classList.replace('hover:bg-yellow-600', 'hover:bg-blue-700');
                }
            }
        };


        // --- MÓDULO 2: PROYECTILES ---
        const projectileSim = {
            isRunning: false, time: 0, dt: 0.05, scale: 10, interval: null,
            state: { x: 0, y: 0, vx: 0, vy: 0, angle: 45, g: 9.8, x0: 0, y0: 0 },
            trail: [], charts: { traj: null, energy: null }, canvas: null, ctx: null, dom: {},

            initCanvas: function() {
                this.canvas = getEl('canvas-projectile');
                if(!this.canvas) return;
                this.ctx = this.canvas.getContext('2d');
                const container = getEl('proj-canvas-container');
                if(container) {
                    this.canvas.width = container.clientWidth;
                    this.canvas.height = container.clientHeight;
                }

                this.dom = {
                    dispT: getEl('disp-proj-t'),
                    dispX: getEl('disp-proj-x'),
                    dispY: getEl('disp-proj-y'),
                    dispVy: getEl('disp-proj-vy'),
                    inputs: {
                        v0: getEl('input-proj-v0'),
                        angle: getEl('input-proj-angle'),
                        g: getEl('input-proj-g')
                    }
                };

                if(this.dom.inputs.angle) {
                    this.dom.inputs.angle.addEventListener('input', (e) => {
                        setText(getEl('disp-angle-val'), e.target.value + '°');
                        if(!this.isRunning) this.drawScene();
                    });
                }

                this.initCharts();
                this.drawScene();
            },

            play: function() {
                if(this.time === 0) {
                    const v0 = parseFloat(this.dom.inputs.v0.value) || 0;
                    const angleDeg = parseFloat(this.dom.inputs.angle.value) || 0;
                    const angleRad = angleDeg * (Math.PI / 180);
                    this.state.g = parseFloat(this.dom.inputs.g.value) || 9.8;
                    this.state.vx = v0 * Math.cos(angleRad);
                    this.state.vy = v0 * Math.sin(angleRad);
                    this.state.x = 0; this.state.y = 0;
                    this.trail = [{x:0, y:0}];
                }
                Object.values(this.dom.inputs).forEach(inp => { if(inp) inp.disabled = true; });
                this.isRunning = true;
                this.updatePlayButton(true);
                this.interval = setInterval(() => this.update(), this.dt * 1000);
            },

            pause: function() {
                this.isRunning = false; clearInterval(this.interval);
                this.updatePlayButton(false);
            },

            reset: function() {
                this.pause(); this.time = 0; this.trail = [];
                Object.values(this.dom.inputs).forEach(inp => { if(inp) inp.disabled = false; });
                this.state.x = 0; this.state.y = 0;
                
                if(this.charts.traj) {
                    this.charts.traj.data.labels = [];
                    this.charts.traj.data.datasets[0].data = [];
                    this.charts.traj.update();
                }
                if(this.charts.energy) {
                    this.charts.energy.data.labels = [];
                    this.charts.energy.data.datasets[0].data = []; // Kinetic
                    this.charts.energy.data.datasets[1].data = []; // Potential
                    this.charts.energy.update();
                }
                this.drawScene();
            },

            togglePlay: function() { if(this.isRunning) this.pause(); else this.play(); },

            update: function() {
                this.time += this.dt;
                this.state.vy -= this.state.g * this.dt;
                this.state.x += this.state.vx * this.dt;
                this.state.y += this.state.vy * this.dt;

                if(this.state.y < 0) {
                    this.state.y = 0;
                    this.pause();
                }

                this.trail.push({x: this.state.x, y: this.state.y});
                
                if(this.trail.length % 5 === 0) {
                    // Update Trajectory
                    if(this.charts.traj) {
                        this.charts.traj.data.labels.push(this.state.x.toFixed(1));
                        this.charts.traj.data.datasets[0].data.push(this.state.y);
                        this.charts.traj.update();
                    }
                    
                    // Update Energies (Assume m=1 kg)
                    const vSq = (this.state.vx * this.state.vx) + (this.state.vy * this.state.vy);
                    const K = 0.5 * 1.0 * vSq;
                    const U = 1.0 * this.state.g * this.state.y;
                    
                    if(this.charts.energy) {
                        this.charts.energy.data.labels.push(this.time.toFixed(1));
                        this.charts.energy.data.datasets[0].data.push(K);
                        this.charts.energy.data.datasets[1].data.push(U);
                        
                        // Limit data points
                        if(this.charts.energy.data.labels.length > 30) {
                            this.charts.energy.data.labels.shift();
                            this.charts.energy.data.datasets[0].data.shift();
                            this.charts.energy.data.datasets[1].data.shift();
                        }
                        this.charts.energy.update();
                    }
                }

                this.drawScene();
                this.updateStats();
            },

            drawScene: function() {
                if(!this.ctx || !this.canvas) return;
                const w = this.canvas.width;
                const h = this.canvas.height;
                const ctx = this.ctx;
                
                ctx.clearRect(0, 0, w, h);
                const originX = 50;
                const originY = h - 50;
                
                const toCanvas = (x, y) => ({
                    cx: originX + (x * this.scale),
                    cy: originY - (y * this.scale)
                });

                // Floor
                ctx.beginPath();
                ctx.fillStyle = '#10b981';
                ctx.fillRect(0, originY, w, 50);

                // Axis
                ctx.beginPath();
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.moveTo(originX, originY); ctx.lineTo(w, originY);
                ctx.moveTo(originX, originY); ctx.lineTo(originX, 0);
                ctx.stroke();

                // Cannon
                const angleVal = this.dom.inputs.angle ? this.dom.inputs.angle.value : 45;
                const angleRad = parseFloat(angleVal) * (Math.PI / 180);
                ctx.save();
                ctx.translate(originX, originY);
                ctx.rotate(-angleRad);
                ctx.fillStyle = '#4c1d95';
                ctx.fillRect(0, -5, 40, 10);
                ctx.restore();

                // Trail
                if(this.trail.length > 0) {
                    ctx.beginPath();
                    ctx.strokeStyle = '#9333ea';
                    ctx.lineWidth = 2;
                    ctx.setLineDash([5, 5]);
                    const start = toCanvas(this.trail[0].x, this.trail[0].y);
                    ctx.moveTo(start.cx, start.cy);
                    for(let i=1; i<this.trail.length; i++) {
                        const p = toCanvas(this.trail[i].x, this.trail[i].y);
                        ctx.lineTo(p.cx, p.cy);
                    }
                    ctx.stroke();
                    ctx.setLineDash([]);
                }

                // Ball
                const pos = toCanvas(this.state.x, this.state.y);
                ctx.beginPath();
                ctx.fillStyle = '#dc2626';
                ctx.arc(pos.cx, pos.cy, 6, 0, Math.PI * 2);
                ctx.fill();
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.stroke();
            },

            updateStats: function() {
                setText(this.dom.dispT, this.time.toFixed(2) + ' s');
                setText(this.dom.dispX, this.state.x.toFixed(2) + ' m');
                setText(this.dom.dispY, this.state.y.toFixed(2) + ' m');
                setText(this.dom.dispVy, this.state.vy.toFixed(2) + ' m/s');
            },

            initCharts: function() {
                const ctxTraj = document.getElementById('chart-proj-traj');
                const ctxEnergy = document.getElementById('chart-proj-energy');
                
                if(ctxTraj) {
                    this.charts.traj = new Chart(ctxTraj.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: [],
                            datasets: [{
                                label: 'Trayectoria',
                                data: [],
                                borderColor: '#9333ea',
                                borderWidth: 2,
                                pointRadius: 0,
                                fill: true,
                                backgroundColor: 'rgba(147, 51, 234, 0.1)'
                            }]
                        },
                        options: {
                            responsive: true, maintainAspectRatio: false, animation: false,
                            scales: { x: { title: {display: true, text: 'Distancia (m)'} }, y: { title: {display: true, text: 'Altura (m)'}, min: 0 } },
                            plugins: { legend: { display: false } }
                        }
                    });
                }

                if(ctxEnergy) {
                    this.charts.energy = new Chart(ctxEnergy.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: [],
                            datasets: [
                                { label: 'Cinética (K)', data: [], borderColor: '#dc2626', borderWidth: 2, pointRadius: 0 },
                                { label: 'Potencial (U)', data: [], borderColor: '#2563eb', borderWidth: 2, pointRadius: 0 }
                            ]
                        },
                        options: {
                            responsive: true, maintainAspectRatio: false, animation: false,
                            scales: { x: { title: {display: true, text: 'Tiempo (s)'} } },
                            plugins: { legend: { display: true, position: 'top' } }
                        }
                    });
                }
            },

            updatePlayButton: function(playing) {
                const btn = document.getElementById('btn-play-pause-projectile');
                const text = document.getElementById('text-play-projectile');
                const icon = document.getElementById('icon-play-projectile');
                if(!btn) return;

                if(playing) {
                    if(text) text.innerText = "Pausar"; 
                    if(icon) icon.innerText = "⏸";
                    btn.classList.replace('bg-purple-600', 'bg-yellow-500'); 
                    btn.classList.replace('hover:bg-purple-700', 'hover:bg-yellow-600');
                } else {
                    if(text) text.innerText = "Lanzar"; 
                    if(icon) icon.innerText = "▶";
                    btn.classList.replace('bg-yellow-500', 'bg-purple-600'); 
                    btn.classList.replace('hover:bg-yellow-600', 'hover:bg-purple-700');
                }
            }
        };

        // --- MÓDULO 3: ROTACIONAL ---
        const rotationalSim = {
            isRunning: false, time: 0, dt: 0.05, interval: null,
            state: { angle: 0, omega: 0, alpha: 0, torque: 0, inertia: 0, L: 0, work: 0 },
            charts: { omega: null, energy: null }, canvas: null, ctx: null, dom: {},

            initCanvas: function() {
                this.canvas = getEl('canvas-rotational');
                if(!this.canvas) return;
                this.ctx = this.canvas.getContext('2d');
                const container = getEl('rot-canvas-container');
                if(container) {
                    this.canvas.width = container.clientWidth;
                    this.canvas.height = container.clientHeight;
                }
                
                this.dom = {
                    inputs: {
                        f: getEl('input-rot-f'),
                        m: getEl('input-rot-m'),
                        r: getEl('input-rot-r')
                    },
                    disp: {
                        torque: getEl('disp-rot-torque'),
                        inertia: getEl('disp-rot-inertia'),
                        alpha: getEl('disp-rot-alpha'),
                        omega: getEl('disp-rot-omega'),
                        momentum: getEl('disp-rot-momentum'),
                        work: getEl('disp-rot-work')
                    }
                };

                this.calculatePhysics();
                this.initCharts();
                this.drawScene();
            },

            calculatePhysics: function() {
                const F = this.dom.inputs.f ? (parseFloat(this.dom.inputs.f.value) || 0) : 0;
                const m = this.dom.inputs.m ? (parseFloat(this.dom.inputs.m.value) || 1) : 1;
                const r = this.dom.inputs.r ? (parseFloat(this.dom.inputs.r.value) || 1) : 1;

                const inertia = 0.5 * m * r * r;
                const torque = F * r;
                const alpha = torque / inertia;

                this.state.inertia = inertia;
                this.state.torque = torque;
                this.state.alpha = alpha;

                setText(this.dom.disp.torque, torque.toFixed(2) + ' N·m');
                setText(this.dom.disp.inertia, inertia.toFixed(2) + ' kg·m²');
                setText(this.dom.disp.alpha, alpha.toFixed(2) + ' rad/s²');
            },

            play: function() {
                this.calculatePhysics();
                Object.values(this.dom.inputs).forEach(inp => { if(inp) inp.disabled = true; });
                this.isRunning = true;
                this.updatePlayButton(true);
                this.interval = setInterval(() => this.update(), this.dt * 1000);
            },

            pause: function() {
                this.isRunning = false; clearInterval(this.interval);
                this.updatePlayButton(false);
            },

            reset: function() {
                this.pause(); this.time = 0;
                Object.values(this.dom.inputs).forEach(inp => { if(inp) inp.disabled = false; });
                this.state.angle = 0; this.state.omega = 0; this.state.work = 0;
                this.calculatePhysics();
                
                // Clear charts
                if(this.charts.omega) {
                    this.charts.omega.data.labels = [];
                    this.charts.omega.data.datasets[0].data = [];
                    this.charts.omega.update();
                }
                if(this.charts.energy) {
                    this.charts.energy.data.labels = [];
                    this.charts.energy.data.datasets[0].data = [];
                    this.charts.energy.update();
                }
                
                setText(this.dom.disp.momentum, '0.00 kg·m²/s');
                setText(this.dom.disp.work, '0.00 J');
                setText(this.dom.disp.omega, '0.00 rad/s');
                
                this.drawScene();
            },

            togglePlay: function() { if(this.isRunning) this.pause(); else this.play(); },

            update: function() {
                this.time += this.dt;
                this.state.omega += this.state.alpha * this.dt;
                this.state.angle += this.state.omega * this.dt;
                this.state.L = this.state.inertia * this.state.omega;
                this.state.work = this.state.torque * this.state.angle;
                
                // Calculate Rotational Kinetic Energy: K = 0.5 * I * omega^2
                const K_rot = 0.5 * this.state.inertia * (this.state.omega * this.state.omega);

                if(Math.round(this.time * 100) % 20 === 0) {
                    const tStr = this.time.toFixed(1);
                    
                    if(this.charts.omega) {
                        this.charts.omega.data.labels.push(tStr);
                        this.charts.omega.data.datasets[0].data.push(this.state.omega);
                        if(this.charts.omega.data.labels.length > 30) { 
                            this.charts.omega.data.labels.shift(); 
                            this.charts.omega.data.datasets[0].data.shift(); 
                        }
                        this.charts.omega.update();
                    }
                    
                    if(this.charts.energy) {
                        this.charts.energy.data.labels.push(tStr);
                        this.charts.energy.data.datasets[0].data.push(K_rot);
                        if(this.charts.energy.data.labels.length > 30) {
                            this.charts.energy.data.labels.shift();
                            this.charts.energy.data.datasets[0].data.shift();
                        }
                        this.charts.energy.update();
                    }
                }

                setText(this.dom.disp.omega, this.state.omega.toFixed(2) + ' rad/s');
                setText(this.dom.disp.momentum, this.state.L.toFixed(2) + ' kg·m²/s');
                setText(this.dom.disp.work, this.state.work.toFixed(2) + ' J');

                this.drawScene();
            },

            drawScene: function() {
                if(!this.ctx || !this.canvas) return;
                const w = this.canvas.width;
                const h = this.canvas.height;
                const ctx = this.ctx;
                const centerX = w / 2;
                const centerY = h / 2;
                const r = Math.min(w, h) * 0.35;

                ctx.clearRect(0, 0, w, h);
                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(this.state.angle);

                // Disk
                ctx.beginPath();
                ctx.arc(0, 0, r, 0, Math.PI * 2);
                const grad = ctx.createRadialGradient(0, 0, r*0.1, 0, 0, r);
                grad.addColorStop(0, '#e5e7eb');
                grad.addColorStop(1, '#9ca3af');
                ctx.fillStyle = grad;
                ctx.fill();
                ctx.strokeStyle = '#4b5563';
                ctx.lineWidth = 3;
                ctx.stroke();

                // Radius Line
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(r, 0);
                ctx.strokeStyle = '#ef4444';
                ctx.lineWidth = 4;
                ctx.stroke();

                // Point
                ctx.beginPath();
                ctx.arc(r, 0, 8, 0, Math.PI * 2);
                ctx.fillStyle = '#ef4444';
                ctx.fill();
                ctx.restore();

                // Force Arrow
                ctx.beginPath();
                ctx.moveTo(centerX, centerY - r);
                ctx.lineTo(centerX + 60, centerY - r); 
                ctx.strokeStyle = '#db2777'; 
                ctx.lineWidth = 4;
                ctx.stroke();
                
                // Arrow Head
                ctx.beginPath();
                ctx.moveTo(centerX + 60, centerY - r);
                ctx.lineTo(centerX + 50, centerY - r - 5);
                ctx.lineTo(centerX + 50, centerY - r + 5);
                ctx.fillStyle = '#db2777';
                ctx.fill();

                ctx.fillStyle = '#db2777';
                ctx.font = 'bold 16px sans-serif';
                ctx.fillText('F', centerX + 30, centerY - r - 10);
                
                // Pivot
                ctx.beginPath();
                ctx.arc(centerX, centerY, 5, 0, Math.PI * 2);
                ctx.fillStyle = '#111';
                ctx.fill();
            },

            initCharts: function() {
                const ctxOmega = document.getElementById('chart-rot-omega');
                const ctxEnergy = document.getElementById('chart-rot-energy');
                
                if(ctxOmega) {
                    this.charts.omega = new Chart(ctxOmega.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: [],
                            datasets: [{
                                label: 'Velocidad Angular (rad/s)',
                                data: [],
                                borderColor: '#db2777',
                                borderWidth: 2,
                                fill: true,
                                backgroundColor: 'rgba(219, 39, 119, 0.1)',
                                pointRadius: 0
                            }]
                        },
                        options: {
                            responsive: true, maintainAspectRatio: false, animation: false,
                            scales: { x: { title: {display: true, text: 'Tiempo (s)'} } },
                            plugins: { legend: { display: false } }
                        }
                    });
                }
                
                if(ctxEnergy) {
                    this.charts.energy = new Chart(ctxEnergy.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: [],
                            datasets: [{
                                label: 'Energía Cinética (J)',
                                data: [],
                                borderColor: '#8b5cf6', // Violet
                                borderWidth: 2,
                                fill: true,
                                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                                pointRadius: 0
                            }]
                        },
                        options: {
                            responsive: true, maintainAspectRatio: false, animation: false,
                            scales: { x: { title: {display: true, text: 'Tiempo (s)'} } },
                            plugins: { legend: { display: false } }
                        }
                    });
                }
            },

            updatePlayButton: function(playing) {
                const btn = document.getElementById('btn-play-pause-rotational');
                const text = document.getElementById('text-play-rotational');
                const icon = document.getElementById('icon-play-rotational');
                if(!btn) return;

                if(playing) {
                    if(text) text.innerText = "Pausar"; 
                    if(icon) icon.innerText = "⏸";
                    btn.classList.replace('bg-pink-600', 'bg-yellow-500'); 
                    btn.classList.replace('hover:bg-pink-700', 'hover:bg-yellow-600');
                } else {
                    if(text) text.innerText = "Girar"; 
                    if(icon) icon.innerText = "▶";
                    btn.classList.replace('bg-yellow-500', 'bg-pink-600'); 
                    btn.classList.replace('hover:bg-yellow-600', 'hover:bg-pink-700');
                }
            }
        };

        // Iniciar App
        window.addEventListener('load', () => {
            linearSim.init();
            
            // Animación fondo CSS
            const style = document.createElement('style');
            style.innerHTML = `
                @keyframes blob {
                    0% { transform: translate(0px, 0px) scale(1); }
                    33% { transform: translate(30px, -50px) scale(1.1); }
                    66% { transform: translate(-20px, 20px) scale(0.9); }
                    100% { transform: translate(0px, 0px) scale(1); }
                }
                .animate-blob { animation: blob 7s infinite; }
                .animation-delay-2000 { animation-delay: 2s; }
                .animation-delay-4000 { animation-delay: 4s; }
            `;
            document.head.appendChild(style);
        });

    </script>
</body>
</html>
